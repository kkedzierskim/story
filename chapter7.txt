chapter 7 of my book. writen in branch newc-chapter